* IDENTIFICANDO O ARQUIVO A SER USADO:

Após baixar o arquivo pelo link: https://download.inep.gov.br/microdados/microdados_enem_2019.zip

- O arquivo a ser usado está dentro da pasta dados, com o nome de "MICRODADOS_ENEM_2019.csv"
*********************************************************************

*No portal do Azure, nos recursos de Machine Learning

1) Criação de um Workspace 

Grupo de recursos: Hackathon
Nome do workspace: Hackathon
Região: Sul do Brasil
*********************************************************************

*Na guia Gerir, na opção Computação

2) Criação de uma instância de computação

Tipo de máquina virtual: CPU
Tamanho da máquina virtual: Standard_DS11_v2 
Nome de computação: DadosEnem 
Habilitar o acesso SSH: não selecionado

3) Criação de um Cluster de Cálculo

Prioridade da máquina virtual: dedicada
Tipo de máquina virtual: CPU
Tamanho da máquina virtual: Standard_DS11_v2
Nome de computação: DadosEnem1
Número mínimo de nós: 0
Número máximo de nós: 2
Segundos de espera antes de reduzir verticalmente: 120
Habilitar o acesso SSH: não selecionado
*********************************************************************

*Na guia Author, na opção Designer/Estruturador 

4) Criação de um pipeline denominado "Notas do enem"
*********************************************************************

*Na guia recursos, na opção Conjunto de Dados

5) Criação de um Conjunto de Dados a partir de ficheiros locais
   Envie o arquivo "MICRODADOS_ENEM_2019.csv"
 * O Azure já vem com todas as opções selecionadas corretamente
 * Como o ficheiro é grande pode haver demora para carregar o arquivo (não feche a aba, pois ele cancela o processo)
5.3) Na seção esquemas, desmarque todas as colunas que não são necessárias
5.4) Deixe apenas as colunas com as notas de todas as áreas de conhecimento

**********************************************************************

*Na guia Author, na opção Designer/Estruturador, abra o pipeline criado anteriormente

6) Selecione a seção "Conjuntos de dados de exemplo (Datasets)" e arraste o conjunto de dados criado para tela.

6.1) A partir da seção "Transformação de Dados (Data Tranformation)" arrastar o módulo "Selecionar Colunas no Conjunto de Dados" conectando a saída do módulo "NotasEnem"

6.2) Selecionando as colunas das notas de Ciências da Natureza e Matemática

6.3) A partir da seção "Transformação de Dados" arrastar o módulo "Limpar Dados Ausentes (Clean Missing Data)" conectando a saída do módulo "Selecionar Colunas no Conjunto de Dados"  ------- Selecionar a coluna das notas de Matemática
Taxa mínima de valores ausentes: 0,0
Taxa máxima de valores ausentes: 1,0
Modo de limpeza: remover linha inteira

6.4) Arraste um módulo "Normalizar Dados (Normalize Data)" conecte a saída mais à esquerda do módulo "Limpar Dados Ausentes" para a entrada do módulo Normalizar Dados.
Selecionar Metodo MinMax
Selecionar a coluna das notas de Matemática

7) Primeira versão do pipeline Completo

8)Selecione Enviar e execute o pipeline como um novo experimento

9)Na seção "Transformações de Dados", selecione o módulo "Dividir Dados". Em seguida, conecte a saída Conjunto de dados transformado (à esquerda) do módulo Normalizar dados para a entrada do módulo Dividir dados.
Modo de divisão: dividir linhas
Fração das linhas no primeiro conjunto de dados de saída: 0,5
Semente aleatória: 123
Divisão estratificada: Falso

10)A partir da seção "Treinamento de Modelo" arrastar o módulo "Treinar Modelo" conectando a saída esquerda do módulo "Normalizar Dados"  ------- Selecionar o nome de coluna "NU_NOTA_CN"

11) Na seção "Algoritmos de Machine Learning" e, sob "Regressão", selecione "Regressão Linear". Em seguida, conecte a saída dele à entrada do Modelo não treinado (à esquerda) do módulo Treinar Modelo.

12) Na seção "Pontuação e Avaliação de Modelo" selecione "Pontuar Modelo". Em seguida, conecte a saída do módulo Treinar Modelo à entrada Modelo treinado (à esquerda) do módulo Pontuar Modelo e arraste a saída do Conjunto de dados de resultado2 (à direita) do módulo Dividir dados para a entrada Conjunto de dados (à direita) do módulo Pontuar Modelo.

13) Pipeline Completo - Selecione Enviar e execute o pipeline usando o experimento existente

14) Na seção "Pontuação e avaliação do modelo", selecione o módulo "Avaliar Modelo" e conecte a saída do módulo "Pontuar Modelo" à entrada do Conjunto de dados pontuado (à esquerda) do módulo "Avaliar Modelo."

15) Selecione Enviar e execute o pipeline usando o experimento existente

15.1) Resultados obtidos observando a saída de dados da pontuação do modelo

16) Na lista suspensa Criar um pipeline de inferência, clique em Pipeline de inferência em tempo real. 

17) Renomeie o novo pipeline para "Prever Nota CN"

18) Substitua o conjunto de dados "NotasEnem" com um módulo "Inserir Dados Manualmente" que não inclua a coluna de "NU_NOTA_CN".
Conecte o novo módulo "Inserir Dados Manualmente" à mesma entrada de conjunto de dados do módulo "Selecionar Colunas no Conjunto de Dados" como a Entrada do Serviço Web.

Como o objetivo é mostrar a previsão de apenas uma nota de Ciências da Natureza,vamos usar de exemplo a nota 700 em Matemática
Para isso modifique os dados CSV para:

ALUNO,NU_NOTA_MT
1,700.0

19) Modifique o módulo Selecionar colunas no conjunto de dados para remover referências à coluna "NU_NOTA_CN" (agora ausente).

20) Remova o módulo Avaliar Modelo.

21) Insira um módulo Executar script Python antes da saída do serviço Web para retornar apenas o rótulo previsto.
Conecte a saída módulo Pontuar modelo à entrada Dataset1 (mais à esquerda) de Executar script Python e conecte a saída do módulo Executar script Python à Saída do serviço Web.

22) Substitua todo o script Python padrão pelo seguinte código (que seleciona apenas a coluna "Rótulos Pontuados" e renomeia-a para predicted_nota):

import pandas as pd

def azureml_main(dataframe1 = None, dataframe2 = None):

    scored_results = dataframe1[['Scored Labels']]
    scored_results.rename(columns={'Scored Labels':'predicted_nota'},
                        inplace=True)
    return scored_results
 

23) Envie o pipeline como um novo experimento denominado "InferenciaAutomaticaNota" no cluster de cálculo.

24) Quando o pipeline for concluído, selecione o módulo "Executar script Python" e, no painel de configurações, na guia "Saída + logs", visualize o Conjunto de dados de resultados para ver a nota de Ciências da Natureza prevista  nos dados de entrada.

Com base nos resultados obtidos para uma nota 700.0 em Matemática, a nota prevista para Ciências da Natureza será: 557.8304

Agora o modelo é capaz de prever notas da área de Ciências da Natureza com base nas notas de matemática.





































